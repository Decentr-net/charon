<ng-container *transloco="let translate; read: 'portal.transfer_page'">
  <div class="transfer-page__header">
    <button
      app-button-back
      [appNavigateBack]="['../']"
    ></button>

    <span appTypeface="subheader">
      {{ translate('send') }}
    </span>

    <div
      class="transfer-page__balance"
      *ngIf="balance$ | async as balance"
      appTypeface="paragraph"
    >
      <svg-icon
        class="transfer-page__balance-icon"
        key="decentr-hub"
      ></svg-icon>
      {{ balance | microValue }} <app-currency-symbol></app-currency-symbol>
    </div>
  </div>

  <form
    [formGroup]="form"
    autocomplete="off"
    appBindQueryParams
    appSubmitAfterValidation
    (ngSubmit)="onSubmit()"
  >

    <div class="transfer-page__form__inputs-container">
      <app-transfer-input
        class="transfer-page__form__control-amount"
        formControlName="amount"
        [appTypeface]="isOpenedInPopup ? 'header-4' : 'header-3'"
      >
        <span>{{ translate('form.amount.label') }}</span>

        <span *ngIf="fee$ | async as fee" ngProjectAs="[label-right]">
          <ng-container *ngIf="form.valid">
            {{ translate('form.amount.fee') }}: {{ fee | microValue }}
          </ng-container>
        </span>
      </app-transfer-input>

      <app-form-error
        class="transfer-page__form__error transfer-page__form__error-amount"
        controlName="amount"
        appTypeface="caption"
      ></app-form-error>

      <svg-icon
        *appBrowserTabView
        class="transfer-page__form__icon"
        key="arrow-left"
        size="xl"
      ></svg-icon>

      <app-transfer-input
        class="transfer-page__form__control-to"
        [rows]="2"
        formControlName="to"
        [appTypeface]="isOpenedInPopup ? 'paragraph' : 'subheader'"
      >
        {{ translate('form.to.label') }}

        <svg-icon
          class="transfer-page__form__memo-icon"
          key="memo"
          size="md"
          [title]="translate('form.memo.title')"
          (click)="openMemoPopup()"
        ></svg-icon>
      </app-transfer-input>

      <div class="transfer-page__form__error transfer-page__form__error-to">
        <app-form-error
          *ngIf="form.get('to').touched"
          controlName="to"
          appTypeface="caption"
        ></app-form-error>
      </div>
    </div>

    <div
      class="transfer-page__form__actions-container"
      appTypeface="paragraph"
    >
      <button
        class="transfer-page__form__action-button"
        app-button
        color="grey"
        [disabled]="isPageDisabled"
        [appNavigateBack]="['../']"
      >
        {{ translate('cancel') }}
      </button>

      <button
        class="transfer-page__form__action-button"
        app-button
        color="primary"
        type="submit"
        [disabled]="isPageDisabled || (canSend$ | async) === false"
      >
        {{ translate(isPageDisabled ? 'sending' : 'send') }}
      </button>
    </div>

    <ng-template #memo>
      <app-input
        [maxlength]="100"
        [rows]="3"
        formControlName="comment"
      >
        <span ngProjectAs="[label]">{{ translate('form.memo.label') }}</span>
      </app-input>

      <mat-dialog-actions align="end">
        <button
          app-button
          mat-dialog-close
        >
          {{ translate('form.memo.button') }}
        </button>
      </mat-dialog-actions>
    </ng-template>
  </form>
</ng-container>
